<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能鱼类识别系统</title>
    <!-- 引入外部资源 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>

    <!-- Tailwind 自定义配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#36BFFA',
                        accent: '#0FC6C2',
                        dark: '#0F172A',
                        light: '#F1F5F9'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>

    <!-- 自定义工具类与动画 -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .transition-custom {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .backdrop-blur {
                backdrop-filter: blur(8px);
            }
        }
    </style>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fadeIn 0.5s ease forwards; }
        .upload-area-active {
            border-color: #165DFF;
            background-color: rgba(22, 93, 255, 0.05);
        }
        html { scroll-behavior: smooth; }
    </style>
</head>

<body class="bg-gradient-to-br from-light to-blue-50 min-h-screen font-sans text-dark">
    <!-- 导航栏（固定在顶部） -->
    <header class="sticky top-0 z-50 bg-white/80 backdrop-blur shadow-sm">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-fish text-primary text-2xl"></i>
                <h1 class="text-xl md:text-2xl font-bold text-primary">智能鱼类识别系统</h1>
            </div>
            <!-- 桌面端导航 -->
            <nav class="hidden md:flex items-center space-x-6">
                <a href="#home" class="text-gray-600 hover:text-primary transition-custom font-medium">首页</a>
                <a href="#features" class="text-gray-600 hover:text-primary transition-custom font-medium">功能</a>
                <a href="#about" class="text-gray-600 hover:text-primary transition-custom font-medium">关于</a>
                <a href="#upload" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-custom font-medium">开始识别</a>
            </nav>
            <!-- 移动端菜单按钮 -->
            <button class="md:hidden text-gray-600 hover:text-primary">
                <i class="fa fa-bars text-xl"></i>
            </button>
        </div>
    </header>
    <main class="container mx-auto px-4 py-8">
        <!-- 英雄区域（首页核心宣传） -->
        <section id="home" class="py-12 md:py-20 text-center">
            <div class="max-w-3xl mx-auto">
                <h2 class="text-[clamp(2rem,5vw,3.5rem)] font-bold text-dark mb-6 leading-tight text-shadow">
                    快速准确识别鱼类种类
                </h2>
                <p class="text-gray-600 text-lg md:text-xl mb-8">
                    基于深度学习技术，上传图片即可快速识别鱼类种类，支持多种常见淡水与海水鱼类。
                </p>
                <a href="#upload" class="inline-flex items-center bg-primary hover:bg-primary/90 text-white px-6 py-3 rounded-lg text-lg font-medium transition-custom shadow-lg hover:shadow-xl">
                    <i class="fa fa-upload mr-2"></i> 上传图片
                </a>
            </div>
        </section>

        <!-- 功能特点（系统优势） -->
        <section id="features" class="py-16 bg-white rounded-2xl shadow-md mb-16">
            <h2 class="text-3xl font-bold text-center mb-12">系统特点</h2>
            <div class="grid md:grid-cols-3 gap-8 px-4">
                <div class="bg-light p-6 rounded-xl shadow-sm hover:shadow-md transition-custom text-center">
                    <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fa fa-bolt text-primary text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3">快速识别</h3>
                    <p class="text-gray-600">毫秒级响应速度，无需等待，即时获取识别结果</p>
                </div>

                <div class="bg-light p-6 rounded-xl shadow-sm hover:shadow-md transition-custom text-center">
                    <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fa fa-check-circle text-primary text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3">高准确率</h3>
                    <p class="text-gray-600">采用ResNet50先进模型，提供精准的鱼类识别结果</p>
                </div>

                <div class="bg-light p-6 rounded-xl shadow-sm hover:shadow-md transition-custom text-center">
                    <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fa fa-database text-primary text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3">丰富种类</h3>
                    <p class="text-gray-600">支持9类常见鱼类识别，满足大多数识别需求</p>
                </div>
            </div>
        </section>

        <!-- 核心功能：图片上传与识别结果 -->
        <section id="upload" class="py-12 mb-16">
            <h2 class="text-3xl font-bold text-center mb-10">鱼类识别</h2>

            <div class="grid md:grid-cols-2 gap-8 items-start">
                <!-- 左侧：图片上传区域 -->
                <div class="bg-white p-6 rounded-2xl shadow-md">
                    <h3 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fa fa-picture-o text-primary mr-2"></i> 上传图片
                    </h3>

                    <!-- 上传表单 -->
                    <form id="upload-form" enctype="multipart/form-data" method="post" action="/">
                        <div id="drop-area" class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center cursor-pointer hover:border-primary transition-custom mb-6">
                            <i class="fa fa-cloud-upload text-4xl text-gray-400 mb-4"></i>
                            <p class="text-gray-600 mb-2">拖放图片到此处，或</p>
                            <label class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg inline-block cursor-pointer transition-custom">
                                <i class="fa fa-folder-open mr-1"></i> 选择图片
                                <input type="file" id="file-input" name="file" accept="image/*" class="hidden" required>
                            </label>
                            <p class="text-gray-400 text-sm mt-4">支持 JPG、PNG 格式，文件大小不超过 5MB</p>
                        </div>
                        <button type="submit" class="mt-2 w-full bg-primary hover:bg-primary/90 text-white py-3 rounded-lg font-medium transition-custom flex items-center justify-center">
                            <i class="fa fa-search mr-2"></i> 开始识别
                        </button>
                    </form>
                    <p id="upload-error" class="text-red-600 mt-2 hidden"></p>
                </div>

                <!-- 右侧：识别结果展示 -->
                <div id="result-section" class="bg-white p-6 rounded-2xl shadow-md hidden animate-fade-in">
                    <h3 class="text-xl font-semibold mb-6 flex items-center">
                        <i class="fa fa-bar-chart text-primary mr-2"></i> 识别结果
                    </h3>

                    <!-- 上传的图片预览 -->
                    <div class="mb-6">
                        <h4 class="font-medium text-gray-700 mb-3">上传的图片:</h4>
                        <img id="uploaded-image" alt="上传的图片" class="w-full max-h-64 object-contain rounded-lg shadow" />
                    </div>

                    <!-- 主要识别结果（类别+准确率） -->
                    <div class="mb-8">
                        <h4 class="font-medium text-gray-700 mb-3">识别种类:</h4>
                        <div class="bg-light rounded-xl p-4 flex items-center">
                            <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mr-4">
                                <i class="fa fa-fish text-primary text-2xl"></i>
                            </div>
                            <div>
                                <h5 id="result-name" class="text-xl font-bold"></h5>
                                <div id="accuracy-section" class="flex items-center mt-1">
                                    <div class="w-full bg-gray-200 rounded-full h-2.5 mr-2">
                                        <div id="accuracy-bar" class="bg-primary h-2.5 rounded-full" style="width: 0%"></div>
                                    </div>
                                    <span id="accuracy-value" class="text-sm font-medium text-gray-600"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 概率分布图 -->
                    <div id="probability-section">
                        <h4 class="font-medium text-gray-700 mb-3">概率分布:</h4>
                        <img id="probability-chart" alt="概率分布图" class="w-full max-h-64 object-contain rounded-lg shadow" />
                    </div>
                </div>
            </div>
        </section>

        <!-- 支持识别的鱼类 -->
        <section class="py-12 mb-16 bg-white rounded-2xl shadow-md">
            <h2 class="text-3xl font-bold text-center mb-10">支持识别的鱼类</h2>
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 px-4">
                <div class="bg-light rounded-xl p-4 text-center hover:shadow-md transition-custom">
                    <img src="/fish_photos/hetun/hetun_1.jpg" alt="河豚" class="mx-auto mb-3 w-16 h-16 object-cover rounded-full shadow" />
                    <h3 class="font-medium">河豚</h3>
                </div>
                <div class="bg-light rounded-xl p-4 text-center hover:shadow-md transition-custom">
                    <img src="/fish_photos/hudieyu/hudieyu_1.jpg" alt="蝴蝶鱼" class="mx-auto mb-3 w-16 h-16 object-cover rounded-full shadow" />
                    <h3 class="font-medium">蝴蝶鱼</h3>
                </div>
                <div class="bg-light rounded-xl p-4 text-center hover:shadow-md transition-custom">
                    <img src="/fish_photos/jinyu/jinyu_1.jpg" alt="金鱼" class="mx-auto mb-3 w-16 h-16 object-cover rounded-full shadow" />
                    <h3 class="font-medium">金鱼</h3>
                </div>
                <div class="bg-light rounded-xl p-4 text-center hover:shadow-md transition-custom">
                    <img src="/fish_photos/jiyu/jiyu_1.jpg" alt="鲫鱼" class="mx-auto mb-3 w-16 h-16 object-cover rounded-full shadow" />
                    <h3 class="font-medium">鲫鱼</h3>
                </div>
                <div class="bg-light rounded-xl p-4 text-center hover:shadow-md transition-custom">
                    <img src="/fish_photos/longyu/ly_1.jpg" alt="龙鱼" class="mx-auto mb-3 w-16 h-16 object-cover rounded-full shadow" />
                    <h3 class="font-medium">龙鱼</h3>
                </div>
                <div class="bg-light rounded-xl p-4 text-center hover:shadow-md transition-custom">
                    <img src="/fish_photos/luohanyu/luohanyu_1.jpg" alt="罗汉鱼" class="mx-auto mb-3 w-16 h-16 object-cover rounded-full shadow" />
                    <h3 class="font-medium">罗汉鱼</h3>
                </div>
                <div class="bg-light rounded-xl p-4 text-center hover:shadow-md transition-custom">
                    <img src="/fish_photos/nianyu/nianyu_1.jpg" alt="鲶鱼" class="mx-auto mb-3 w-16 h-16 object-cover rounded-full shadow" />
                    <h3 class="font-medium">鲶鱼</h3>
                </div>
                <div class="bg-light rounded-xl p-4 text-center hover:shadow-md transition-custom">
                    <img src="/fish_photos/qingdaofu/qingdaofu_1.jpg" alt="清道夫" class="mx-auto mb-3 w-16 h-16 object-cover rounded-full shadow" />
                    <h3 class="font-medium">清道夫</h3>
                </div>
                <div class="bg-light rounded-xl p-4 text-center hover:shadow-md transition-custom">
                    <img src="/fish_photos/shiban/shiban_1.jpg" alt="石斑" class="mx-auto mb-3 w-16 h-16 object-cover rounded-full shadow" />
                    <h3 class="font-medium">石斑</h3>
                </div>
            </div>
        </section>

        <!-- 关于系统（说明与应用场景） -->
        <section id="about" class="py-12 text-center">
            <div class="max-w-3xl mx-auto">
                <h2 class="text-3xl font-bold mb-6">关于系统</h2>
                <p class="text-gray-600 mb-6">
                    本智能鱼类识别系统基于深度学习技术，采用ResNet50先进卷积神经网络模型，
                    通过对大量鱼类图像数据的训练，实现了对常见鱼类的高精度识别。
                </p>
                <p class="text-gray-600">
                    系统可广泛应用于渔业资源调查、水产养殖管理、生态环境监测等领域，为相关工作提供便捷高效的技术支持。
                </p>
            </div>
        </section>
    </main>

<script>
    const dropArea = document.getElementById('drop-area');
    const fileInput = document.getElementById('file-input');
    const uploadForm = document.getElementById('upload-form');
    const uploadError = document.getElementById('upload-error');
    const resultSection = document.getElementById('result-section');
    const uploadedImage = document.getElementById('uploaded-image');
    const resultName = document.getElementById('result-name');
    const accuracyBar = document.getElementById('accuracy-bar');
    const accuracyValue = document.getElementById('accuracy-value');
    const accuracySection = document.getElementById('accuracy-section');
    const probabilitySection = document.getElementById('probability-section');
    const probabilityChart = document.getElementById('probability-chart');

    // 拖放样式切换
    dropArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropArea.classList.add('upload-area-active');
    });
    dropArea.addEventListener('dragleave', (e) => {
        e.preventDefault();
        dropArea.classList.remove('upload-area-active');
    });
    dropArea.addEventListener('drop', (e) => {
        e.preventDefault();
        dropArea.classList.remove('upload-area-active');
        if (e.dataTransfer.files.length) {
            fileInput.files = e.dataTransfer.files;
            // 预览上传的图片
            previewImage(e.dataTransfer.files[0]);
        }
    });

    // 文件选择变化时预览图片
    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length) {
            previewImage(e.target.files[0]);
        }
    });

    // 预览上传的图片
    function previewImage(file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            uploadedImage.src = e.target.result;
        }
        reader.readAsDataURL(file);
    }

    // 表单提交拦截，使用fetch异步提交，避免页面刷新
    uploadForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        uploadError.classList.add('hidden');
        resultSection.classList.add('hidden');

        const file = fileInput.files[0];
        if (!file) {
            uploadError.textContent = '请选择图片文件';
            uploadError.classList.remove('hidden');
            return;
        }

        const allowedTypes = ['image/png', 'image/jpeg', 'image/jpg', 'image/gif'];
        if (!allowedTypes.includes(file.type)) {
            uploadError.textContent = '仅支持 PNG、JPG、JPEG、GIF 格式的图片';
            uploadError.classList.remove('hidden');
            return;
        }

        const formData = new FormData();
        formData.append('file', file);

        try {
            const response = await fetch('/', {
                method: 'POST',
                body: formData
            });
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || '上传失败');
            }
            const data = await response.json();

            // 显示结果区域
            resultSection.classList.remove('hidden');

            // 设置识别结果
            resultName.textContent = data.predicted_label;

            // 检查是否为"该鱼类未入库"
            if (data.predicted_label === '该鱼类未入库') {
                // 隐藏准确率和概率分布
                accuracySection.style.display = 'none';
                probabilitySection.style.display = 'none';
            } else {
                // 显示准确率和概率分布
                accuracySection.style.display = 'flex';
                probabilitySection.style.display = 'block';

                // 设置准确率
                const probPercent = (data.probability * 100).toFixed(2);
                accuracyBar.style.width = probPercent + '%';
                accuracyValue.textContent = probPercent + '% 准确率';

                // 设置概率分布图
                if (data.prob_img) {
                    probabilityChart.src = 'data:image/png;base64,' + data.prob_img;
                } else {
                    probabilitySection.style.display = 'none';
                }
            }
        } catch (err) {
            uploadError.textContent = '上传或识别出错: ' + err.message;
            uploadError.classList.remove('hidden');
        }
    });
</script>
</body>
</html>